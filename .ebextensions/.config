files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_restart_gunicorn.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Restart Gunicorn after deployment
      supervisorctl -c /opt/python/etc/supervisord.conf restart gunicorn

option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: "eshop.wsgi:application"

container_commands:
  01_migrate:
    command: "source /var/app/venv/*/bin/activate && python manage.py migrate"
    leader_only: true  # Run this command only once by the environment leader
  01_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python manage.py collectstatic --noinput"
    leader_only: true
  02_create_superuser:
    command: "source /var/app/venv/*/bin/activate && python manage.py createsuperuser --noinput --username mwiti --email mmm97.dev@gmail.com"
    # for non-interactive mode, username, email is required
    leader_only: true
  03_restart_nginx:
    command: "sudo service nginx restart"

packages:
  yum:
    gcc-c++: []
    python3-devel: []
    libpq-devel: []