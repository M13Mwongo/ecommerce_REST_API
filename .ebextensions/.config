files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/99_restart_gunicorn.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Restart Gunicorn after deployment
      supervisorctl -c /opt/python/etc/supervisord.conf restart gunicorn

option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: "eshop.wsgi:application"

container_commands:
  01_migrate:
    command: "python manage.py migrate"
    leader_only: true  # Run this command only once by the environment leader

packages:
  yum:
    gcc-c++: []
    python3-devel: []
    postgresql-devel: []

  python:
    psycopg2: []

commands:
  01_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python manage.py collectstatic --noinput"
    leader_only: true

  02_create_superuser:
    command: "source /var/app/venv/*/bin/activate && python manage.py createsuperuser --noinput"
    leader_only: true
    
  03_restart_nginx:
    command: "sudo service nginx restart"
